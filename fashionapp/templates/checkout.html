{% extends 'base.html' %}
{% load static %}
{% block checkout %}
<script src="https://checkout.flutterwave.com/v3.js"></script>
    <!-- Breadcrumb Begin -->
    <div class="breadcrumb-option">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="breadcrumb__links">
                        <a href="{% url 'fashionapp:index' %}"><i class="fa fa-home"></i> Home</a>
                        <span>Shopping cart</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Breadcrumb End -->

    <!-- Checkout Section Begin -->
    <section class="checkout spad">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <h6 class="coupon__link"><span class="icon_tag_alt"></span> <a href="#">Have a coupon?</a> Click
                    here to enter your code.</h6>
                </div>
            </div>
            <form action="#" method="POST" class="checkout__form">
                {% csrf_token %}
                <div class="row">
                    <div class="col-lg-8">
                        <h5>Billing detail</h5>
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>First Name <span>*</span></p>
                                    {{detailform.firstname}}
                                    <!-- <input type="text" id="firstname"> -->
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Last Name <span>*</span></p>
                                    {{detailform.lastname}}
                                    <!-- <input type="text" id="lastname"> -->
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="checkout__form__input">
                                    <p>Country <span>*</span></p>
                                    {{detailform.country}}
                                    <!-- <input type="text" id="country"> -->
                                </div>
                                <div class="checkout__form__input">
                                    <p>Address <span>*</span></p>
                                    {{detailform.address}}
                                    <!-- <input type="text" placeholder="Street Address">
                                    <input type="text" placeholder="Apartment. suite, unite ect ( optinal )"> -->
                                </div>
                                <div class="checkout__form__input">
                                    <p>Town/City <span>*</span></p>
                                    {{detailform.city}}
                                    <!-- <input type="text"> -->
                                </div>
                                <div class="checkout__form__input">
                                    <p>Region/State <span>*</span></p>
                                    {{detailform.region}}
                                    <!-- <input type="text"> -->
                                </div>
                                <div class="checkout__form__input">
                                    <p>Postcode/Zip <span>*</span></p>
                                    {{detailform.postcode}}
                                    <!-- <input type="text"> -->
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Phone <span>*</span></p>
                                    {{detailform.phone}}
                                    <!-- <input type="text" id="phone"> -->
                                </div>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6">
                                <div class="checkout__form__input">
                                    <p>Email <span>*</span></p>
                                    {{detailform.email}}
                                    <!-- <input type="email" id="email"> -->
                                </div>
                            </div>
                            <div class="col-lg-12">
                                <div class="checkout__form__checkbox">
                                    <label for="acc">
                                        Create an acount?
                                        <input type="checkbox" id="acc">
                                        <span class="checkmark"></span>
                                    </label>
                                    <p>Create am account by entering the information below. If you are a returing
                                        customer login at the <br />top of the page</p>
                                    </div>
                                    <div class="checkout__form__input">
                                        <p>Account Password <span>*</span></p>
                                        {{detailform.password}}
                                        <!-- <input type="text"> -->
                                    </div>
                                    <div class="checkout__form__checkbox">
                                        <label for="note">
                                            Note about your order, e.g, special note for delivery
                                            <input type="checkbox" id="note">
                                            <!-- {{detailform.note}} -->
                                            <!-- <span class="checkmark"></span> -->
                                        </label>
                                    </div>
                                    <div class="checkout__form__input">
                                        <p>Order notes <span>*</span></p>
                                        <input id="order_note" type="text" placeholder="Note about your order, e.g, special note for delivery">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4">
                            <div class="checkout__order">
                                <h5>Your order</h5>
                                <div class="checkout__order__product">
                                    <ul>
                                        <li>
                                            <span class="top__text">Product</span>
                                            <span class="top__text__right">Total</span>
                                        </li>
                                    </ul>
                                    <ul id="orders">
                                        
                                        <!-- <li>{{cart}}<span>$ <script>document.write(parseInt("{{cart.quantity}}") * parseFloat("{{cart.item.price}}"))</script></span></li> -->
                                        
                                        <!-- <li>01. Chain buck bag <span>$ 300.0</span></li>
                                        <li>02. Zip-pockets pebbled<br /> tote briefcase <span>$ 170.0</span></li>
                                        <li>03. Black jean <span>$ 170.0</span></li>
                                        <li>04. Cotton shirt <span>$ 110.0</span></li> -->
                                    </ul>
                                </div>
                                <div class="checkout__order__total">
                                    <ul>
                                        <li>Subtotal <span>GH₵ <span></span>{{total_orders.total}}</span></li>
                                        <li>Total <span>GH₵ <span></span>{{total_orders.total}}</span></li>
                                    </ul>
                                </div>
                                <div class="checkout__order__widget">
                                    <label for="o-acc">
                                        Create an acount?
                                        <input type="checkbox" id="o-acc">
                                        <span class="checkmark"></span>
                                    </label>
                                    <p>Create am acount by entering the information below. If you are a returing customer
                                    login at the top of the page.</p>
                                    <!-- <label for="check-payment">
                                        Cheque payment
                                        <input type="checkbox" id="check-payment">
                                        <span class="checkmark"></span>
                                    </label>
                                    <label for="paypal">
                                        PayPal
                                        <input type="checkbox" id="paypal">
                                        <span class="checkmark"></span> -->
                                    <!-- </label> -->
                                </div>
                                <a  href="/checkout/ordered/" class="site-btn">Place oder</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </section>{% csrf_token %}
        <!-- Checkout Section End -->
        
<script>
    
    var cartValue = localStorage.getItem("total");
    // var cartObj = JSON.parse( cartValue );
    
    $('.checkout__order__total ul li span span')[0].innerText = cartValue;
    $('.checkout__order__total ul li span span')[1].innerText = cartValue;
    
    
    $('.site-btn').on('click', function(e){
        e.preventDefault()
        var username = $('#id_firstname').val() +" "+ $('#lastname').val()
        var email = $('#id_email').val()
        var phone = $('#id_phone').val()
        var country = $('#id_country').val()
        var city = $('#id_city').val()
        var region = $('#id_region').val()
        var total = $('.checkout__order__total ul li span span')[1].innerText
        
        function makePayment() {
            FlutterwaveCheckout({
            public_key: "FLWPUBK-66106623098f258c4726fa3ea93bcf8e-X",
            tx_ref: "hooli-tx-1920bbtyt",
            amount: 1.00 , //total,
            currency: "GHS",
            country: "GH",
            payment_options: "card, mobilemoneyghana, ussd",
            redirect_url: // specified redirect URL
            "",
            meta: {
            consumer_id: 23,
            consumer_mac: "92a3-912ba-1192a",
            },
            customer: {
            email: email,
            phone_number: phone,
            name: username,
            country: country,
            region: region,
            city: city,
            },
            callback: function (data) {
            console.log(data);
            },
            onclose: function() {
            // close modal
            },
            customizations: {
            title: "My store",
            description: "Payment for items in cart",
            logo: "https://assets.piedpiper.com/logo.png",
        },
      });
    }
    makePayment()
    });
    
    console.log($('.orders'))
    var arry = []
    for (var key in sessionStorage) {
        var cartValue = sessionStorage.getItem(key);
        var cartObj = JSON.parse( cartValue );
        // console.log(cartValue)
        try{
            arry.push(cartObj.qty + ' ' +cartObj.product)
        
            $('#orders').append('<li>'+cartObj.qty+' '+cartObj.product+'<span>GH₵ '+cartObj.qty*cartObj.price+'</span></li>')
        }catch(e){
            
        }
    }
    
    // arry.push($('.checkout__order__total ul li span span')[1].innerText)
    arry.toString()
    localStorage.setItem("arry", arry)
    
</script>
{% endblock %}